# AI 协作规则（AI Operating Rules）

> 本文件用于统一 AI 与开发者之间的协作方式，是跨项目、跨文档通用的工作协议。  
> 它不描述具体产品功能，而是指导如何在项目中使用 `spec.md`、`style.md`、`tasks.md` 等协作文档。

---

## 0. 优先级与裁决顺序

- 文档优先级（从高到低）：
  1. `spec.md`（需求 / 行为逻辑）
  2. `rules.md`（本文件，协作规则与流程约束）
  3. `style.md`（视觉样式与交互表现）
  4. `tasks.md`（任务拆分与执行节奏）
  5. 其他推断或上下文（聊天记录、历史习惯等）

- 若文档内容发生冲突：
  - 一律以 `spec.md > rules.md > style.md > tasks.md > 其他推断` 为裁决顺序。
  - AI 必须主动指出冲突点并请求决策，而不是自行选其中一个版本执行。

---

## 1. 全局工作流程（适用于所有任务）

执行任何非琐碎任务前，AI 必须遵循以下步骤：

1. **识别相关文档**
   - 判断当前任务是否涉及：
     - 功能需求与行为逻辑 → 查阅 `spec.md`
     - 视觉样式与交互表现 → 查阅 `style.md`
     - 执行计划与任务拆分 → 查阅 `tasks.md`
   - 若文档缺失或明显不完整，应先提示并建议补全。

2. **确认目标与边界**
   - 用简洁的要点总结：本次任务要达成什么、不做什么。
   - 将自己的理解反馈给用户，等待确认或修正后再继续。

3. **拆解执行步骤**
   - 以 3–7 个步骤列出执行计划（可以对应 `tasks.md` 的父任务 / 子任务结构）。
   - 标明每步的大致输入、输出和依赖前置条件。

4. **执行并生成产物**
   - 按计划逐步实现代码或文档，而不是一次性给出最终结果。
   - 对于已有 `tasks.md` 的场景，应优先遵循其中的子任务顺序。

5. **自检与汇总**
   - 对照 `spec.md` / `style.md` / `tasks.md` 自行检查：
     - 是否遗漏关键需求或边界条件？
     - 输出是否可直接执行 / 使用（不是草稿碎片）？
     - 相关文档是否需要同步更新（如示例代码路径、配置说明等）？
   - 自检通过后再给出终稿回答。

---

## 2. 提问与信息缺失原则

- **生成前先提问：**
  - 若任务描述中存在关键不确定因素（行为逻辑、边界条件、重要配置），必须先提问澄清；
  - 对于功能需求、交互逻辑、视觉样式、任务边界等关键点，如文档未明确说明，必须通过与用户沟通补全，而不是自行假设。

- **信息缺失不得臆断：**
  - 对于会明显影响架构或用户体验的决策，AI 不得凭空捏造事实（例如：自行设定业务流程、接口协议、品牌定位）；
  - 如确需假设，必须：
    1. 明确标注为「假设」；
    2. 说明该假设对实现的影响；
    3. 建议用户确认或在后续版本中修正。

---

## 3. 回答格式规范（Summary / Reasoning / Output / Next Step）

在重要任务的回复中（包括功能设计、任务拆分、样式体系设计等），AI 的回答应尽量采用如下结构化格式：

1. **Summary（总结 / 结论）**
   - 1–3 条要点，概括本次回答的核心结论或决策；
   - 回答「这次我到底帮你完成 / 决定了什么」。

2. **Reasoning（理由 / 取舍说明）**
   - 对涉及选择、权衡或假设的部分，简要说明理由；
   - 不需要展开冗长推理链，只需列出关键判断依据（如：与 spec 一致、与现有样式体系兼容、减少未来维护成本等）。

3. **Output（产物）**
   - 给出可直接使用的结果：代码、配置、Markdown 文档片段等；
   - 若修改了现有文件，说明修改了哪些文件、哪些主要位置（不必贴出所有上下文）。

4. **Next Step（下一步）**
   - 指出 AI 下一步可以做什么，或用户需要提供什么输入；
   - 在有 `tasks.md` 的项目中，应明确下一步对应哪个任务 / 子任务编号。

> 若信息不足以安全决策 → **不要** 用臆测填满上述四项，而是先进入「提问澄清」模式，补齐关键信息后再输出结构化结果。

---

## 4. 任务列表与执行节奏（与 tasks.md 的协作）

当项目存在 `tasks.md` 时，AI 在执行任务时必须遵循以下约定（与 `generate-tasks.md` 保持一致）：

1. **一次只做一个子任务**
   - 不得在未与用户确认的情况下连续完成多个子任务；
   - 完成一个子任务后，应先更新 `tasks.md` 并暂停，等待用户确认再继续。

2. **完成协议**
   - 完成某个子任务时，立即将对应条目的 `- [ ]` 改为 `- [x]`；
   - 当某个父任务下所有子任务均为 `[x]` 时，同时将该父任务标记为 `- [x]`。

3. **任务列表维护**
   - 在执行过程中，如发现新的必要任务，应补充到 `tasks.md` 中；
   - 保持 `Relevant Files` 部分与实际修改的文件同步，并为每个文件写明一句用途说明。

4. **开始前检查**
   - 在开始工作前，先阅读 `tasks.md`，确认当前「下一个要做的子任务」是哪一条，并与用户对齐。

---

## 5. AI 必须主动执行的行为

在任何项目中，AI 应当始终主动做以下事情，而不是被动等待提问：

- **检查依赖文档是否需要同步更新：**
  - 修改功能行为 → 检查 `spec.md` 是否需要同步；
  - 修改 UI 样式或组件 → 检查 `style.md` 是否需要同步；
  - 修改任务边界或拆解方式 → 检查 `tasks.md` 是否需要同步。

- **验证输出可用性：**
  - 代码：至少在逻辑上可运行（无明显语法错误、路径错误等），必要时说明依赖的运行环境；
  - 文档：结构清晰、可直接作为团队参考，而不是散乱笔记。

- **发现逻辑空洞时提醒：**
  - 若需求存在明显缺失、矛盾或无法闭环，必须显式提醒用户，而不是「跳过这部分」继续往下写。

- **保持风格与系统一致性：**
  - 组件命名、间距体系、排版，应与既有 `style.md` 和代码中的实践一致；
  - 避免在未说明的情况下突然引入新的设计体系或命名方式。

---

## 6. 常驻指令（行为准则）

AI 在任何回答中，都应遵守以下常驻指令：

- **避免幻想式产出：**
  - 不构造用户未提供、文档未说明的事实；
  - 必须区分「事实」「假设」「建议」，并用文字标清。

- **保持风格一致：**
  - 响应式策略、组件命名方式、间距体系、Typography 等，应与现有文档和代码保持一致；
  - 对确需改变的模式，应先提出「重构建议」，经确认后再执行。

- **优先提出更优建议，而不是机械执行：**
  - 在不违背 `spec.md` 的前提下，如发现明显更优解（更易维护、更安全、更符合用户习惯），可主动提出，并说明利弊；
  - 若用户明确要求「严格按现有方案执行」，则以后者为准。

---

## 7. 提交代码与开发日志（本仓库约定）

> 以下约定可以作为本仓库内 AI 与开发者协作时的默认规则；在其他项目中，可按需复用或调整。

### 8.1 提交代码（Git 提交规范）

当用户明确要求执行 Git 提交时，AI 应遵循：

- **只提交本次改动涉及的文件**，避免将无关改动混入同一次提交；
- 提交信息使用 **中文**，并遵循 Angular 提交信息规范：
  - 常用 `type`：`feat`（新功能）、`fix`（修复）、`docs`（文档）、`refactor`（重构）、`chore`（杂项）等；
  - 示例：`docs: 新增 AI 协作规则并抽离文档模板职责`。
- 在提交前，尽量：
  - 确认文件已保存且无明显语法错误；
  - 简要检查是否有遗漏的文件未加入提交。

> 若当前环境不允许执行 Git 命令，AI 应说明「提交规范」但不强行模拟提交。

### 8.2 开发者日记（docs/dev-log.md）

- 所有重要的结构调整、规范变更、重大 bug 修复，应记录在 `docs/dev-log.md` 中。
- 记录格式：
  - 文件中按日期倒序排列；
  - 每天使用标题：`## YYYY-MM-DD 开发日志`；
  - 最新日期的日志写在最前面。
- 每条日志建议包括：
  - 修改了哪些文件；
  - 每个文件的变更目的；
  - 解决了什么问题（具体描述修复的 bug 或实现的功能）；
  - 如何解决的（技术选型与实现思路）；
  - 为什么这么改（逻辑、约束或用户行为层面的原因）；
  - 预期效果（若属于优化类改动，可说明对体验 / 性能 / 维护成本的影响）；
  - 未完成事项与下一步动作。

- 如 AI 无法完整掌握某些改动的背景，应在日志中标明「需要补充背景 / 决策过程」，提醒人工补充。

---

### 7.3 本地完工提示（可选）

- 在本地完成一组任务或一个阶段性目标后，如需要声音提醒，可以在终端运行以下命令：

  ```bash
  powershell -c "(New-Object Media.SoundPlayer 'C:\\Windows\\Media\\tada.wav').PlaySync()"
  ```

- 建议在适合的位置（例如 `spec.md` 或 `tasks.md` 的「Notes」或执行说明中）加入一句简短提示，例如：  
  「如需本地完工提示，参见 `rules.md` 中的通知命令。」

---

## 8. 语言使用规范

本节约定本项目中中英文的使用范围，避免文档与代码语言混杂。

### 8.1 中文使用范围（内部沟通）

- `spec.md`、`style.md`、`tasks.md` 等内部项目说明文档；
- 团队内部沟通记录（如设计评审纪要、需求讨论结论）；
- 项目管理文档（看板说明、迭代计划等）；
- 内部会议纪要与决策记录。

### 8.2 英文使用范围（所有对外与代码相关内容）

**代码层面：**

- 所有代码注释使用英文；
- 变量名、函数名、类名、文件名使用英文；
- 开发文档（如 README、API 说明等对开发者开放文档）使用英文；
- 测试数据、示例数据使用英文；
- API 文档、接口返回字段说明使用英文。

**网站内容：**

- 所有面向终端用户的界面文字使用英文；
- 按钮、标题、副标题、说明文字使用英文；
- 错误提示与校验信息使用英文；
- 帮助文档、内嵌教程、FAQ 使用英文；
- 用户注册 / 登录、设置页面等对外表单界面使用英文。

**部署与运维相关：**

- 服务器与环境配置（如环境变量名、配置文件键名）使用英文；
- 域名、路径前缀等对外标识使用英文；
- 数据库设计（表名、字段名）使用英文；
- 日志记录、监控报警消息使用英文。

> 说明：如遇特殊业务需要使用其他语言（例如需要多语言支持），应在 `spec.md` 中单独说明，并在实现中通过 i18n 机制处理，而不是直接在代码或模板中混写多种语言。

---

**总结：**  
`rules.md` 规定了 AI 协作的「元规则」——如何读文档、如何问问题、如何决定输出结构、如何协调 `spec.md` / `style.md` / `tasks.md`、以及如何提交代码与记录开发日志。  
在此基础上，`create-prd.md`、`generate-tasks.md` 和 `design-style.md` 只负责各自领域的具体模板与结构，不再重复这些协作层面的约定。***
